name: master workflow

on:
#    workflow_dispatch
#  push:
#    paths-ignore:
#      - '.github/workflows/gradle.yml'
#      - 'README.md'
#  schedule:
#   - cron: '*/5 * * * *'
  

  push:
    branches: [ master ]


jobs:
  #if: ${{ github.event.workflow_run.conclusion == 'success' }}

  job1:
    name: Job1
    runs-on: ubuntu-20.04
    environment: STG
 #   env:
#      VARIABLE: CidrBlock
    steps:
    
    - name: print number of processes
      run: |
        cat /proc/sys/kernel/pid_max
        
    - name: print number of threads
      run: |    
        cat /proc/sys/kernel/threads-max
        
    - name: Checkout source code
      uses: actions/checkout@v2
      with:
       fetch-depth: 0
         
    - name: Set up JDK 12
      uses: actions/setup-java@v2
      with:
        java-version: '12'
        distribution: 'adopt' 
  
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
      
    - name: Cache Gradle packages
      uses: actions/cache@v2
      with:
          path: |
             ~/.gradle/caches
             ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/build.gradle', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-
      
    - name: Build with Gradle
      id: code-build
      run: |
        ./gradlew clean build   
